#!/usr/bin/env perl
#
# "Musimathics" pg. 358 - Voss's Method
#
use strict;
use warnings;

my $max   = shift || 16;
my @notes = @ARGV ? @ARGV : qw( C5 Ds5 F5 G5 As5 C6 );

my @seed = map { int rand @notes } 1 .. 4;

my @result;

for my $n ( 0 .. $max ) {
    $result[$n] = $notes[ voss( $n, \@seed ) ];
}
use Data::Dumper;print Dumper\@result;

sub voss {
    my ( $n, $list ) = @_;

    my $sum = 0;

    for my $k ( 0 .. @$list - 1 ) {
        if ( ( $n % ( 2 ** $k ) ) == 0 ) {
            $list->[$k] = rand_range( -1, 1 );
        }

        $sum += $list->[$k];
    }

    return $sum;
}

sub rand_range {
    my ( $lower, $upper ) = @_;
    return int( rand( $upper - $lower ) ) + $lower;
}
